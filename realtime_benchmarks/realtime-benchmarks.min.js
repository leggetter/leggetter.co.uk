function BenchmarkService(a,b){this.name="NOT SET";this._channelName=a;this._serviceListener=b}BenchmarkService.prototype._onMessage=function(a){this._serviceListener.onMessage(a)};BenchmarkService.prototype._onReady=function(){this._serviceListener.onReady()};BenchmarkService.prototype._log=function(a){this._serviceListener.onLog(this.name+": "+a)};BenchmarkService.prototype.send=function(){throw"not implemented";};BenchmarkService.prototype.disconnect=function(){throw"not implemented";};
function PubNubService(){BenchmarkService.apply(this,arguments);this.name="PubNub";this.pubnub=PUBNUB.init({publish_key:"pub-a1c89fc1-c4a0-4ac9-a784-d42824e1c0eb",subscribe_key:"sub-be77f868-1ee3-11e2-b53c-85075d7b5343"});var a=this;a.pubnub.subscribe({channel:a._channelName,restore:!1,callback:function(b){a._onMessage(b)},disconnect:function(){a._log("Connection Lost.Will auto-reconnect when Online.")},reconnect:function(){a._log("And we're Back!")},connect:function(){a._onReady()}})}
PubNubService.prototype=new BenchmarkService;PubNubService.prototype.send=function(a){this.pubnub.publish({channel:this._channelName,message:a})};PubNubService.prototype.disconnect=function(){this.pubnub.unsubscribe({channel:this._channelName})};
function PusherService(){BenchmarkService.apply(this,arguments);this.name="Pusher";this._subscriptionCount=0;var a=this;this._pusherSubscriber=new Pusher("c9b72d1013a84c2cec48");this._subscribeChannel=this._pusherSubscriber.subscribe(this._channelName);this._subscribeChannel.bind("pusher:subscription_succeeded",function(){a._subscriptionSucceeded()});this._subscribeChannel.bind("client-event",function(b){a._onMessage(b)});this._pusherPublisher=new Pusher("c9b72d1013a84c2cec48");this._publisherChannel=
this._pusherPublisher.subscribe(this._channelName);this._publisherChannel.bind("pusher:subscription_succeeded",function(){a._subscriptionSucceeded()})}PusherService.prototype=new BenchmarkService;PusherService.prototype._subscriptionSucceeded=function(){++this._subscriptionCount;2===this._subscriptionCount&&this._onReady()};PusherService.prototype.send=function(a){this._publisherChannel.trigger("client-event",a)};PusherService.prototype.disconnect=function(){this._pusherSubscriber.disconnect();this._pusherPublisher.disconnect()};
function RealtimeCoService(){BenchmarkService.apply(this,arguments);this.name="RealtimeCo";var a=this;loadOrtcFactory(IbtRealTimeSJType,function(b,c){null==c&&a._init(b)})}RealtimeCoService.prototype=new BenchmarkService;
RealtimeCoService.prototype._init=function(a){var b=this;this._client=a.createClient();this._client.setId("LatencyClient");this._client.setConnectionTimeout(15E3);this._client.setClusterUrl("http://ortc-developers.realtime.co/server/2.1/");this._client.onConnected=function(){b._client.subscribe(b._channelName,!0,function(a,d,e){e=JSON.parse(e);b._onMessage(e)});b._onReady()};this._client.onException=function(a,d){var e=d;"Invalid connection."==d&&(e+=" Please reload the page to authenticate again");
b._log("Error: "+e)};this._client.connect("2wFviN","NOT_USED_BECAUSE_AUTH_IS_SET_OFF_IN_THE_DASHBOARD")};RealtimeCoService.prototype.send=function(a){this._client.send(this._channelName,JSON.stringify(a))};RealtimeCoService.prototype.disconnect=function(){this._client.disconnect()};
function FirebaseService(){BenchmarkService.apply(this,arguments);this.name="Firebase";this.fb=new Firebase("https://benchmarks.firebaseio.com/");this.connState=this.fb.child(".info/connected");this.connState.on("value",this._connectionStateChanged,this);this.benchmark=this.fb.child(this._channelName);this.benchmark.onDisconnect().remove();this.benchmark.on("child_added",this._childAdded,this)}FirebaseService.prototype=new BenchmarkService;
FirebaseService.prototype._connectionStateChanged=function(a){!0===a.val()&&this._onReady()};FirebaseService.prototype._childAdded=function(a){a=a.val();this._log("FB: childAdded: "+JSON.stringify(a));a.time=new Date(a.time);this._onMessage(a)};FirebaseService.prototype.send=function(a){this._log("FB: sending: "+JSON.stringify(a));a.time=a.time.getTime();this.benchmark.push(a,function(){})};FirebaseService.prototype.disconnect=function(){Firebase.goOffline()};
function HydnaService(){var a=this;BenchmarkService.apply(a,arguments);a.name="Hydna";a.channel=new HydnaChannel("leggetter.hydna.net/"+a._channelName,"rw");a.channel.onopen=function(){a._log("onopen");a._onReady()};a.channel.onclose=function(){a._log("onclose")};a.channel.onmessage=function(b){b.data=JSON.parse(b.data);a._onMessage(b.data)}}HydnaService.prototype=new BenchmarkService;HydnaService.prototype.send=function(a){a=JSON.stringify(a);this.channel.send(a)};
HydnaService.prototype.disconnect=function(){this.channel.close()};function GoInstantService(){var a=this;BenchmarkService.apply(a,arguments);a.name="GoInstant";a.connectUrl="https://goinstant.net/ccf8fe39696c/benchmarks";a.connection=null;a.benchmark=null;goinstant.connect(a.connectUrl,function(b,c,d){if(b)throw b;a.connection=c;a.benchmark=d.key("/benchmark");a.benchmark.on("set",{local:!0},function(b){a._onMessage(b)});a._onReady()})}GoInstantService.prototype=new BenchmarkService;
GoInstantService.prototype._handleResponse=function(a){if(a)throw a;};GoInstantService.prototype.send=function(a){this.benchmark.set(a)};GoInstantService.prototype.disconnect=function(){this.connection.disconnect()};
function FanoutService(a,b){BenchmarkService.call(this,"+"+a,b);this.name="Fanout";this.realmId="d7d63e3a";this.client=new Fpp.Client("http://pubsub.fanout.io/r/"+this.realmId);var c=this;this.channel=this.client.Channel(this._channelName);this.channel.on("state-changed",function(a){"subscribed"==a.type&&c._onReady()});this.channel.on("data",function(a){c._onMessage(a)})}FanoutService.prototype=new BenchmarkService;
FanoutService.prototype.send=function(a){var a={items:[{fpp:a}]},b=new XMLHttpRequest;b.onreadystatechange=function(){};b.open("POST","http://api.fanout.io/realm/"+this.realmId+"/publish/"+this._channelName+"/",!0);b.setRequestHeader("Content-Type","application/json");b.send(JSON.stringify(a))};FanoutService.prototype.disconnect=function(){this.channel.cancel()};
function BenchmarkRunner(a,b){this.version="<VERSION>";this._services=a;this._options=b||{};this._serviceIndex=0;this._messageCountTo=20;this._sendNextUponReceipt=!0;this._testChannelName="private-"+"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});this._serviceLatencyResults={};this._logMessages=[];this._service;this._localMsg;this._messageCount;this._testLatencyResults}
BenchmarkRunner.prototype._testInit=function(){this._tester=null;this._localMsg={text:"TODO: send larger, potentially configurable text",time:null,timeout:null};this._messageCount=0;this._testLatencyResults=[]};
BenchmarkRunner.prototype.onMessage=function(a){this.onLog(this._service.name+": <<< "+JSON.stringify(a));if(a.timeout!=this._localMsg.timeout)this.onLog(this._service.name+": <<< received message, but not within 2 seconds");else{var b=new Date,a=Date.parse(a.time),b=b-a;this._testLatencyResults.push(b);this.onLog(this._service.name+": <<< latency: "+b+"ms");this._sendNextUponReceipt&&(clearTimeout(this._localMsg.timeout),this._sendNextMessage())}};BenchmarkRunner.prototype.onReady=function(){this._sendNextMessage()};
BenchmarkRunner.prototype.onLog=function(a){this._logMessages.push(a);this._options.logToConsole&&console.log(a)};
BenchmarkRunner.prototype._sendNextMessage=function(){var a=this;this._messageCount++;this._messageCount<this._messageCountTo?(this._localMsg.time=new Date,this._localMsg.timeout=setTimeout(function(){setTimeout(function(){a._sendNextMessage()},0)},1E3),this.onLog(this._service.name+": >>> "+JSON.stringify(this._localMsg)),this._service.send(this._localMsg)):(this._service.disconnect(),this.onLog("TEST COMPLETE"),this.onLog("RESULTS: "+this._testLatencyResults.join(", ")+" (Average: "+BenchmarkRunner.getAverage(this._testLatencyResults)+
"ms)"),this._serviceLatencyResults[this._service.name]=this._testLatencyResults,this._nextTest())};BenchmarkRunner.prototype._nextTest=function(){this._service=this._getNextService();if(null===this._service){this.onLog("ALL SERVICES TESTED");for(var a in this._serviceLatencyResults){var b=this._serviceLatencyResults[a];this.onLog("RESULT for "+a+": "+b.join("\t")+"\t(Average: "+BenchmarkRunner.getAverage(b)+"ms)")}this._options.completed&&this._options.completed(this._serviceLatencyResults)}};
BenchmarkRunner.prototype._getNextService=function(){var a=null;this._services[this._serviceIndex]&&(this._testInit(),a=new this._services[this._serviceIndex](this._testChannelName,this),++this._serviceIndex);return a};BenchmarkRunner.prototype.start=function(){this._nextTest()};BenchmarkRunner.getAverage=function(a){for(var b=0,c=a.length,d=0;d<c;++d)b+=a[d];return b/c};
